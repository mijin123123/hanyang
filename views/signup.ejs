<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="한전과 20년 고정계약 체결, 안전한 태양광 수익 설계, 매월 이자수익 세전 최대 30% 지급">
    <meta name="keywords" content="태양광,태양광발전사업,태양열,태양광투자,신재생에너지,고수익,안정적인투자,안전한투자,1억투자,한양에너지,조합원,제테크">
    <meta name="author" content="한양에너지">
    <link rel="icon" href="img/favi.ico" type="image/jpeg">
    
    <!-- 폰트 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS 파일 -->
    <link rel="stylesheet" href="css/global.css?v=1754220183">
    <link rel="stylesheet" href="css/header.css?v=1754220183">
    <link rel="stylesheet" href="css/utilities.css?v=1754220183">
    <script src="js/auth.js"></script>
    <title>회원가입 | 한양에너지</title>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
    /* 회원가입 폼 스타일 */
    body {
        font-family: 'Pretendard', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
        padding-top: 100px;
    }

    .signup-container {
        max-width: 600px;
        margin: 50px auto;
        background: white;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .signup-container h2 {
        text-align: center;
        color: #0056a3;
        margin-bottom: 30px;
        font-size: 28px;
        font-weight: 700;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        transition: border-color 0.3s ease;
        box-sizing: border-box;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #0056a3;
        box-shadow: 0 0 0 3px rgba(0, 86, 163, 0.1);
    }

    .form-group input[readonly] {
        background-color: #f5f5f5;
        cursor: not-allowed;
    }

    .field-with-button {
        display: flex;
        gap: 10px;
        margin-top: 5px;
    }

    .field-with-button input {
        flex: 1;
    }

    .field-with-button button {
        padding: 12px 20px;
        background-color: #0056a3;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s ease;
        white-space: nowrap;
    }

    .field-with-button button:hover {
        background-color: #004080;
    }

    .terms-container {
        border: 1px solid #ddd;
        padding: 20px;
        margin: 20px 0;
        border-radius: 5px;
        background-color: #f8f9fa;
    }

    .terms-container label {
        display: block;
        margin: 10px 0;
        font-weight: 500;
        cursor: pointer;
    }

    .terms-container input[type="checkbox"] {
        width: auto;
        margin-right: 8px;
    }

    .terms-link {
        color: #0066cc;
        text-decoration: none;
        margin-left: 5px;
        font-size: 14px;
    }

    .terms-link:hover {
        text-decoration: underline;
    }

    .submit-btn {
        width: 100%;
        padding: 15px;
        background-color: #0056a3;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-top: 20px;
    }

    .submit-btn:hover {
        background-color: #004080;
    }

    .error-message {
        color: #dc3545;
        font-size: 14px;
        margin-top: 5px;
        background: none;
        border: none;
        padding: 0;
        display: block;
    }

    .success-message {
        color: #28a745;
        font-size: 14px;
        margin-top: 5px;
        background: none;
        border: none;
        padding: 0;
        display: block;
    }

    /* readonly 상태 시 스타일 변경 */
    input[name="referral_code"][readonly] {
        background-color: #f5f5f5;
        cursor: not-allowed;
        border-color: #ddd;
    }

    /* 팝업 스타일 */
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        display: none;
    }

    .popup-overlay.active {
        display: flex;
    }

    .popup-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .popup-content h3 {
        color: #0056a3;
        margin-bottom: 15px;
    }

    .popup-content button {
        background-color: #0056a3;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 15px;
    }

    /* 개선된 푸터 스타일 */
    .modern-footer {
        margin-top: 100px;
        background-color: #535353;
        color: #ecf0f1;
        font-family: 'Pretendard', sans-serif;
        padding: 40px 20px 20px;
        font-size: 14px;
        line-height: 1.6;
    }

    /* 푸터 컨테이너 */
    .modern-footer .footer-container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        max-width: 1200px;
        margin: 0 auto;
        gap: 30px;
    }

    /* 섹션 스타일 */
    .modern-footer .footer-section {
        flex: 1;
        min-width: 220px;
        margin-bottom: 20px;
    }

    /* 로고 및 SNS 섹션 */
    .modern-footer .logo-section {
        display: flex;
        flex-direction: column;
    }

    .modern-footer .footer-logo {
        margin-bottom: 15px;
    }

    .modern-footer .logo-img {
        max-width: 100%;
        width: 270px;
        height: auto;
        filter: brightness(0) invert(1);
    }

    .modern-footer .sns-links {
        display: flex;
        gap: 15px;
        margin-top: 15px;
    }

    .modern-footer .sns-links a {
        color: #ecf0f1;
        font-size: 20px;
        transition: color 0.3s;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background-color: rgba(255,255,255,0.1);
    }

    .modern-footer .sns-links a:hover {
        color: #3498db;
        background-color: rgba(255,255,255,0.2);
    }

    /* 링크 스타일 */
    .modern-footer .links-section h4 {
        font-size: 17px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #ffffff;
        position: relative;
        padding-bottom: 8px;
    }

    .modern-footer .links-section h4::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        width: 40px;
        height: 2px;
        background-color: #3498db;
    }

    .modern-footer .footer-links {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .modern-footer .footer-links li {
        margin-bottom: 12px;
    }

    .modern-footer .footer-links a {
        text-decoration: none;
        color: #bdc3c7;
        transition: all 0.3s;
        display: block;
        padding: 5px 0;
    }

    .modern-footer .footer-links a:hover {
        color: #3498db;
        padding-left: 5px;
    }

    /* 연락처 섹션 */
    .modern-footer .contact-section h4 {
        font-size: 17px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #ffffff;
        position: relative;
        padding-bottom: 8px;
    }

    .modern-footer .contact-section h4::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        width: 40px;
        height: 2px;
        background-color: #3498db;
    }

    .modern-footer .contact-info {
        margin-bottom: 20px;
    }

    .modern-footer .contact-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .modern-footer .contact-icon {
        margin-right: 12px;
        color: #3498db;
        font-size: 16px;
        margin-top: 3px;
        min-width: 16px;
    }

    .modern-footer .contact-text {
        flex: 1;
        word-break: keep-all;
    }

    .modern-footer .footer-phone {
        font-size: 20px;
        font-weight: bold;
        color: #ecf0f1;
        margin: 15px 0;
    }

    /* 카카오톡 상담 버튼 */
    .modern-footer .kakao-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background-color: #FEE500;
        color: #3A1D1D;
        padding: 12px 20px;
        border-radius: 5px;
        font-weight: 600;
        text-decoration: none;
        margin-top: 15px;
        transition: all 0.3s;
        width: 100%;
        box-sizing: border-box;
    }

    .modern-footer .kakao-btn:hover {
        background-color: #ffeb3b;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .modern-footer .kakao-btn i {
        margin-right: 8px;
        font-size: 18px;
    }

    /* 하단 저작권 */
    .modern-footer .footer-bottom {
        text-align: center;
        font-size: 13px;
        color: #bdc3c7;
        border-top: 1px solid rgba(255,255,255,0.1);
        padding-top: 20px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        line-height: 1.5;
    }

    /* 반응형 디자인 - 태블릿 */
    @media (max-width: 900px) {
        .modern-footer .footer-section {
            min-width: calc(50% - 15px);
        }
        
        .modern-footer .footer-container {
            gap: 20px;
        }
    }

    /* QR 코드 영역 */
    .modern-footer .kakao-qr {
        margin-top: 15px;
        text-align: center;
    }

    .modern-footer .kakao-qr img {
        width: 120px;
        height: auto;
        border-radius: 8px;
        margin-bottom: 5px;
    }

    .modern-footer .kakao-qr p {
        font-size: 13px;
        color: #bdc3c7;
        margin: 0;
    }

    /* 반응형 디자인 - 모바일 */
    @media (max-width: 600px) {
        .modern-footer {
            padding: 30px 15px 20px;
        }
        
        .modern-footer .footer-section {
            min-width: 100%;
            margin-bottom: 25px;
        }
        
        .modern-footer .footer-container {
            flex-direction: column;
            gap: 0;
        }
        
        .modern-footer .links-section {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        
        .modern-footer .footer-links a {
            padding: 8px 0;
        }
        
        .modern-footer .logo-img {
            width: 220px;
        }
        
        .modern-footer .kakao-btn {
            padding: 14px 20px;
            font-size: 15px;
        }
        
        .modern-footer .footer-bottom {
            font-size: 12px;
            padding-top: 15px;
            margin-top: 20px;
        }

        .signup-container {
            margin: 20px;
            padding: 30px 20px;
        }
    }
    </style>
</head>
<body>
<!-- 새로운 헤더 구조 -->
<header class="hy-header">
    <div class="hy-container">
        <!-- 로고 영역 -->
        <div class="hy-logo">
            <a href="/">
                <div style="font-size: 24px; font-weight: 800; color: #555555; letter-spacing: 0.5px; font-family: 'Arial', sans-serif; display: flex; align-items: center;">
                    HANYANG ENERGY<span style="width: 8px; height: 8px; background-color: #ff6600; border-radius: 50%; display: inline-block; margin-left: 0px; margin-top: 10px;"></span>
                </div>
            </a>
        </div>

        <!-- 데스크탑 네비게이션 -->
        <nav class="hy-desktop-nav">
            <ul class="hy-main-menu">
                <li class="hy-menu-item hy-has-dropdown">
                    <a href="/ceo_message">회사소개</a>
                    <ul class="hy-submenu">
                        <li><a href="/ceo_message">인사말</a></li>
                        <li><a href="/history">연혁</a></li>
                    </ul>
                </li>
                <li class="hy-menu-item hy-has-dropdown">
                    <a href="/introduce_service">서비스 소개</a>
                    <ul class="hy-submenu">
                        <li><a href="/introduce_service">서비스 소개</a></li>
                        <li><a href="/project_gallery">발전소 현황</a></li>
                    </ul>
                </li>
                <li class="hy-menu-item hy-has-dropdown">
                    <a href="/introduce_product">조합상품</a>
                    <ul class="hy-submenu">
                        <li><a href="/introduce_product">조합상품안내</a></li>
                        <li><a href="/product_list">조합원 상품신청</a></li>
                        <li><a href="/my_investments">조합원 출자현황</a></li>
                        <li><a href="/withdraw_request">조합원 입금/출금</a></li>
                    </ul>
                </li>
                <li class="hy-menu-item hy-has-dropdown">
                    <a href="/announcements">고객센터</a>
                    <ul class="hy-submenu">
                        <li><a href="/announcements">공지사항</a></li>
                        <li><a href="/faq">자주 묻는 질문</a></li>
                        <li><a href="/inquiry_list">1:1문의신청</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- 사용자 인증 영역 -->
        <div class="hy-auth-area">
            <!-- JavaScript로 동적 생성됨 -->
        </div>

        <!-- 모바일 메뉴 토글 버튼 -->
        <button class="hy-mobile-toggle" aria-label="메뉴 열기">
            <span class="hy-toggle-bar"></span>
            <span class="hy-toggle-bar"></span>
            <span class="hy-toggle-bar"></span>
        </button>
    </div>

    <!-- 모바일 메뉴 (별도 레이어로 분리) -->
    <div class="hy-mobile-menu">
        <div class="hy-mobile-container">
            <div class="hy-mobile-header">
                <button class="hy-mobile-close" aria-label="메뉴 닫기">✕</button>
            </div>
            
            <div class="hy-mobile-auth">
                <!-- JavaScript로 동적 생성됨 -->
            </div>
            </div>

            <nav class="hy-mobile-nav">
                <ul>
                    <li class="hy-mobile-dropdown">
                        <button class="hy-mobile-menu-btn">회사소개</button>
                        <ul class="hy-mobile-submenu">
                            <li><a href="/ceo_message">인사말</a></li>
                            <li><a href="/history">연혁</a></li>
                        </ul>
                    </li>
                    <li class="hy-mobile-dropdown">
                        <button class="hy-mobile-menu-btn">서비스 소개</button>
                        <ul class="hy-mobile-submenu">
                            <li><a href="/introduce_service">서비스 소개</a></li>
                            <li><a href="/project_gallery">발전소 현황</a></li>
                        </ul>
                    </li>
                    <li class="hy-mobile-dropdown">
                        <button class="hy-mobile-menu-btn">조합상품</button>
                        <ul class="hy-mobile-submenu">
                            <li><a href="/introduce_product">조합상품안내</a></li>
                            <li><a href="/product_list">조합원 상품신청</a></li>
                            <li><a href="/my_investments">조합원 출자현황</a></li>
                            <li><a href="/withdraw_request">조합원 입금/출금</a></li>
                        </ul>
                    </li>
                    <li class="hy-mobile-dropdown">
                        <button class="hy-mobile-menu-btn">고객센터</button>
                        <ul class="hy-mobile-submenu">
                            <li><a href="/announcements">공지사항</a></li>
                            <li><a href="/faq">자주 묻는 질문</a></li>
                            <li><a href="/inquiry_list">1:1문의신청</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>

<div class="signup-container">
    <h2>회원가입</h2>
    <form action="#" method="POST" onsubmit="return validateForm()">
        <div class="form-group">
            <label for="username">아이디</label>
            <input type="text" id="username" name="username" required oninput="validateUsername()">
            <small id="usernameHelp" class="error-message">아이디는 6자 이상이어야 합니다.</small>
        </div>

        <div class="form-group">
            <label for="password">비밀번호</label>
            <input type="password" id="password" name="password" required oninput="validatePassword()">
            <small id="passwordHelp" class="error-message">비밀번호는 8자 이상이어야 합니다.</small>
        </div>

        <div class="form-group">
            <label for="password_confirmation">비밀번호 확인</label>
            <input type="password" id="password_confirmation" name="password_confirmation" required oninput="confirmPassword()">
            <small id="confirmPasswordHelp" class="error-message"></small>
        </div>

        <div class="form-group">
            <label for="phone">연락처</label>
            <input type="text" id="phone" name="phone" required placeholder="'-' 없이 입력해주세요">
        </div>

        <div class="form-group">
            <label for="address">주소</label>
            <input type="text" id="address" name="address" required readonly>
            <div class="field-with-button">
                <button type="button" onclick="searchAddress()">주소 검색</button>
            </div>
        </div>

        <div class="form-group">
            <label for="detailAddress">상세주소</label>
            <input type="text" id="detailAddress" name="detailed_address">
        </div>

        <div class="form-group">
            <label for="name">성함</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="email">이메일</label>
            <input type="email" id="email" name="email" required placeholder="example@email.com">
        </div>

        <div class="form-group">
            <label for="bank_name">은행명</label>
            <select id="bank_name" name="bank_name" required>
                <option value="">은행 선택</option>
                <option value="KB국민은행">KB국민은행</option>
                <option value="신한은행">신한은행</option>
                <option value="우리은행">우리은행</option>
                <option value="하나은행">하나은행</option>
                <option value="IBK기업은행">IBK기업은행</option>
                <option value="NH농협은행">NH농협은행</option>
                <option value="SC제일은행">SC제일은행</option>
                <option value="한국씨티은행">한국씨티은행</option>
                <option value="카카오뱅크">카카오뱅크</option>
                <option value="케이뱅크">케이뱅크</option>
                <option value="토스뱅크">토스뱅크</option>
                <option value="수협은행">수협은행</option>
                <option value="신협">신협</option>
                <option value="산림조합">산림조합</option>
                <option value="우체국">우체국</option>
                <option value="저축은행">저축은행</option>
                <option value="새마을금고">새마을금고</option>
                <option value="대구은행">대구은행</option>
                <option value="부산은행">부산은행</option>
                <option value="광주은행">광주은행</option>
                <option value="경남은행">경남은행</option>
                <option value="전북은행">전북은행</option>
                <option value="제주은행">제주은행</option>
                <option value="HSBC은행">HSBC은행</option>
                <option value="도이치은행">도이치은행</option>
                <option value="JP모간체이스은행">JP모간체이스은행</option>
                <option value="BOA은행">BOA은행</option>
                <option value="산업은행">산업은행</option>
                <option value="중소기업은행">중소기업은행</option>
                <option value="한국수출입은행">한국수출입은행</option>
            </select>
        </div>

        <div class="form-group">
            <label for="account_number">계좌번호</label>
            <input type="text" id="account_number" name="account_number" required placeholder="'-' 없이 입력해주세요">
        </div>

        <div class="form-group">
            <label for="referral_code">추천인 코드 (선택)</label>
            <input type="text" id="referral_code" name="referral_code" placeholder="추천인 코드가 있다면 입력해주세요">
        </div>

        <div class="terms-container">
            <label>
                <input type="checkbox" id="agree_all" onclick="toggleCheckboxes(this)"> 전체동의
            </label>
            <label>
                <input type="checkbox" class="terms-checkbox" name="terms_of_service" required> 회원가입 약관
                <a href="#" target="_blank" class="terms-link">전문보기 &gt;</a>
            </label>
            <label>
                <input type="checkbox" class="terms-checkbox" name="privacy_policy" required> 개인정보처리방침안내
                <a href="#" target="_blank" class="terms-link">전문보기 &gt;</a>
            </label>
        </div>

        <button type="submit" class="submit-btn">회원가입</button>
    </form>
</div>

<%- include('partials/footer') %>

<!-- 1:1 문의 플로팅 버튼 -->
<%- include('partials/floating-inquiry-btn') %>

<!-- 팝업 HTML 구조 -->
<div id="popup" class="popup-overlay">
    <div class="popup-content">
        <h3>알림</h3>
        <p id="popupMessage">메시지가 여기에 표시됩니다.</p>
        <button onclick="closePopup()">확인</button>
    </div>
</div>

<script type="text/javascript" async src="https://cdn.channel.io/plugin/ch-plugin-web.js"></script>
<script>
// 새로운 헤더 전용 스크립트
document.addEventListener('DOMContentLoaded', function() {
    // 모바일 메뉴 토글
    const mobileToggle = document.querySelector('.hy-mobile-toggle');
    const mobileMenu = document.querySelector('.hy-mobile-menu');
    const mobileClose = document.querySelector('.hy-mobile-close');
    
    if (mobileToggle && mobileMenu && mobileClose) {
        mobileToggle.addEventListener('click', function() {
            mobileMenu.classList.add('hy-show');
            document.body.style.overflow = 'hidden';
        });
        
        mobileClose.addEventListener('click', function() {
            mobileMenu.classList.remove('hy-show');
            document.body.style.overflow = '';
        });
    }

    // 모바일 서브메뉴 토글
    const mobileMenuBtns = document.querySelectorAll('.hy-mobile-menu-btn');
    mobileMenuBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const submenu = this.nextElementSibling;
            const isOpen = submenu.style.maxHeight;
            
            // 모든 서브메뉴 닫기
            document.querySelectorAll('.hy-mobile-submenu').forEach(menu => {
                if (menu !== submenu) {
                    menu.style.maxHeight = null;
                    menu.previousElementSibling.classList.remove('hy-open');
                }
            });
            
            // 현재 서브메뉴 토글
            if (isOpen) {
                submenu.style.maxHeight = null;
                this.classList.remove('hy-open');
            } else {
                submenu.style.maxHeight = submenu.scrollHeight + 'px';
                this.classList.add('hy-open');
            }
        });
    });

    // 데스크탑 드롭다운
    const desktopItems = document.querySelectorAll('.hy-has-dropdown');
    desktopItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            const submenu = this.querySelector('.hy-submenu');
            if (submenu) {
                submenu.style.display = 'block';
            }
        });
        
        item.addEventListener('mouseleave', function() {
            const submenu = this.querySelector('.hy-submenu');
            if (submenu) {
                submenu.style.display = 'none';
            }
        });
    });
});

// 회원가입 폼 검증 함수들
function closePopup() {
    document.getElementById('popup').classList.remove('active');
    
    // 콜백 함수가 있으면 실행
    if (window.tempCallback) {
        window.tempCallback();
        window.tempCallback = null;
    }
}

function showPopup(message, callback) {
    document.getElementById('popupMessage').textContent = message;
    document.getElementById('popup').classList.add('active');
    
    // 콜백 함수가 있으면 확인 버튼 클릭 시 실행
    if (callback) {
        document.getElementById('popup').setAttribute('data-callback', 'true');
        window.tempCallback = callback;
    } else {
        document.getElementById('popup').removeAttribute('data-callback');
        window.tempCallback = null;
    }
}

function validateUsername() {
    const username = document.getElementById('username').value;
    const usernameHelp = document.getElementById('usernameHelp');

    if (username.length < 6) {
        usernameHelp.textContent = "아이디는 6자 이상이어야 합니다.";
        usernameHelp.style.color = "red";
        return false;
    }

    // 실제 서버 연동 시 AJAX로 중복 확인
    usernameHelp.textContent = "사용 가능한 아이디입니다.";
    usernameHelp.style.color = "green";
    return true;
}

function validatePassword() {
    const password = document.getElementById('password').value;
    const passwordHelp = document.getElementById('passwordHelp');

    if (password.length >= 8) {
        passwordHelp.textContent = "사용 가능한 비밀번호입니다.";
        passwordHelp.style.color = "green";
        return true;
    } else {
        passwordHelp.textContent = "비밀번호는 8자 이상이어야 합니다.";
        passwordHelp.style.color = "red";
        return false;
    }
}

function confirmPassword() {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('password_confirmation').value;
    const confirmPasswordHelp = document.getElementById('confirmPasswordHelp');

    if (password && confirmPassword) {
        if (password === confirmPassword) {
            confirmPasswordHelp.textContent = "비밀번호가 일치합니다.";
            confirmPasswordHelp.style.color = "green";
            return true;
        } else {
            confirmPasswordHelp.textContent = "비밀번호가 일치하지 않습니다.";
            confirmPasswordHelp.style.color = "red";
            return false;
        }
    } else {
        confirmPasswordHelp.textContent = "";
        return false;
    }
}

function searchAddress() {
    new daum.Postcode({
        oncomplete: function(data) {
            let address = '';
            if (data.userSelectedType === 'R') {
                address = data.roadAddress;
            } else {
                address = data.jibunAddress;
            }
            
            if (data.userSelectedType === 'R') {
                if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                    address += ' (' + data.bname + ')';
                }
            }
            
            document.getElementById('address').value = address;
            document.getElementById('detailAddress').focus();
        }
    }).open();
}

function toggleCheckboxes(checkbox) {
    const checkboxes = document.querySelectorAll('.terms-checkbox');
    checkboxes.forEach(cb => cb.checked = checkbox.checked);
}

function validateForm() {
    console.log('validateForm 호출됨'); // 디버깅용
    
    const isUsernameValid = validateUsername();
    const isPasswordValid = validatePassword();
    const isPasswordMatch = confirmPassword();
    
    console.log('Validation 결과:', {
        username: isUsernameValid,
        password: isPasswordValid,
        passwordMatch: isPasswordMatch
    }); // 디버깅용
    
    // 필수 약관 동의 확인
    const termsChecked = document.querySelector('input[name="terms_of_service"]:checked');
    const privacyChecked = document.querySelector('input[name="privacy_policy"]:checked');
    
    console.log('약관 동의 확인:', {
        terms: !!termsChecked,
        privacy: !!privacyChecked
    }); // 디버깅용
    
    if (!termsChecked || !privacyChecked) {
        showPopup('모든 필수 약관에 동의해주세요.');
        return false;
    }
    
    if (isUsernameValid && isPasswordValid && isPasswordMatch) {
        console.log('모든 validation 통과, 회원가입 처리 시작'); // 디버깅용
        // 실제 회원가입 처리
        processSignup();
        return false; // 폼 제출 방지
    }
    
    console.log('Validation 실패'); // 디버깅용
    return false;
}

// 회원가입 처리 함수
async function processSignup() {
    console.log('processSignup 함수 시작'); // 디버깅용
    
    const formData = {
        username: document.getElementById('username').value,
        password: document.getElementById('password').value,
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value + ' ' + (document.getElementById('detailAddress').value || '')
    };
    
    console.log('회원가입 데이터:', formData); // 디버깅용
    
    // 필수 필드 검증
    const requiredFields = ['username', 'password', 'name', 'email', 'phone', 'address'];
    for (const field of requiredFields) {
        if (!formData[field] || formData[field].trim() === '') {
            showPopup(`${field} 필드를 입력해주세요.`);
            return;
        }
    }

    try {
        console.log('서버 회원가입 API 호출 중...'); // 디버깅용
        
        // 서버 API 직접 호출
        const response = await fetch('/signup', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        console.log('회원가입 결과:', result); // 디버깅용
        
        if (result && result.success) {
            showPopup(result.message || '회원가입이 완료되었습니다. 바로 로그인하실 수 있습니다.', function() {
                // 성공 시 로그인 페이지로 이동
                window.location.href = "/login";
            });
        } else {
            showPopup(result?.message || '회원가입에 실패했습니다. 다시 시도해주세요.');
        }
    } catch (error) {
        console.error('회원가입 오류:', error);
        showPopup('회원가입 중 오류가 발생했습니다: ' + (error.message || '알 수 없는 오류'));
    }
}

// Channel.io 설정
(function(){
    var w=window;
    if(w.ChannelIO){return w.console.error("ChannelIO script included twice.");}
    var ch=function(){ch.c(arguments);};
    ch.q=[];
    ch.c=function(args){ch.q.push(args);};
    w.ChannelIO=ch;
    function l(){
        if(w.ChannelIOInitialized){return;}
        w.ChannelIOInitialized=true;
        var s=document.createElement("script");
        s.type="text/javascript";
        s.async=true;
        s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";
        var x=document.getElementsByTagName("script")[0];
        if(x.parentNode){x.parentNode.insertBefore(s,x);}
    }
    if(document.readyState==="complete"){l();}
    else{w.addEventListener("DOMContentLoaded",l);w.addEventListener("load",l);}
})();

ChannelIO('boot', {
    "pluginKey": "42621fdb-9a63-4335-9f53-bbbff11a34e5"
});
</script>

<div id="ch-plugin" class="notranslate" style="z-index: 10000000 !important;">      
    <div id="ch-plugin-entry"><div style="display: block !important;"></div></div>      
    <div id="ch-plugin-script" class="ch-messenger-hidden ch-desk-messenger" style="bottom: 90px !important;right: 24px !important;">        
        <iframe id="ch-plugin-script-iframe" title="Channel chat" style="position:relative!important;height:100%!important;width:100%!important;border:none!important;"></iframe>      
    </div>    
    <style data-styled="active" data-styled-version="5.3.9"></style>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        updateHeaderUserInfo();
    });
</script>

<script src="js/header.js"></script>
</body>
</html>
